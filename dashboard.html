<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Energy Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
<style>
body {
    margin: 0;
    font-family: Segoe UI, Roboto;
    background: linear-gradient(to top right, #3f1e5a, #1c2f5d);
    color: white;
}
.container {
    max-width: 1200px;
    margin: 30px auto;
    padding: 20px;
}
.header {
    text-align: center;
    font-size: 32px;
    font-weight: bold;
    margin-bottom: 20px;
}
.filters {
    background: #36454F;
    padding: 15px;
    border-radius: 12px;
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 20px;
    align-items: center;
}
select, input, button {
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 14px;
}
button {
    background: #355E3B;
    color: white;
    border: none;
    padding: 10px 20px;
    font-size: 16px;
    font-weight: bold;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 5px #2a4730, 0 8px 15px rgba(0,0,0,0.3);
    transition: all 0.2s ease;
}
button:hover {
    background: #3a6a44;
    transform: translateY(-2px);
    box-shadow: 0 8px #2a4730, 0 12px 20px rgba(0,0,0,0.3);
}
button:active {
    transform: translateY(2px);
    box-shadow: 0 3px #2a4730, 0 6px 10px rgba(0,0,0,0.2);
}

/* ─── Progress Bar ─── */
#progressContainer {
    display: none;
    width: 240px;
    height: 10px;
    background: #2a2a3a;
    border-radius: 5px;
    overflow: hidden;
    position: relative;
    margin-left: 12px;
}
#progressShimmer {
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, 
        transparent 0%, 
        #00d4ff44 40%, 
        #7c00ff88 60%, 
        transparent 100%
    );
    animation: shimmer 2.4s linear infinite;
    opacity: 1;
    transition: opacity 0.5s ease;
}
#progressFill {
    position: absolute;
    inset: 0;
    width: 0%;
    background: linear-gradient(90deg, #00d4ff, #7c00ff);
    transition: width 0.7s ease-out;
    box-shadow: 0 0 10px rgba(124, 0, 255, 0.6);
}
@keyframes shimmer {
    0%   { transform: translateX(-120%); }
    100% { transform: translateX(320%);  }
}

/* ─── Dashboard Layout ─── */
.dashboard {
    display: flex;
    gap: 20px;
    align-items: stretch;
    height: 400px;
    margin-bottom: 20px;
}
.chart-container {
    background: #36454F;
    padding: 20px;
    border-radius: 15px;
    flex: 4;
    display: flex;
    align-items: center;
}
.chart-container canvas {
    height: 100% !important;
}
.side-panel {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

/* ─── FIXED GAUGE ALIGNMENT ─── */
.card {
    flex: 1;
    background: #36454F;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: space-between;     /* text left – gauge right */
    padding: 0 20px 0 15px;             /* consistent right padding */
    gap: 15px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.4);
}
.card-text {
    text-align: left;
    flex: 1;
    min-width: 0;
}
.card-title {
    font-size: 12px;
    color: #ccc;
}
.card-value {
    font-size: 18px;
    font-weight: bold;
    white-space: nowrap;
}
.card canvas {
    width: 60px !important;
    height: 60px !important;
    flex-shrink: 0;                     /* prevents shrinking */
}

/* ─── SCADA ─── */
.scada-container {
    background: #36454F;
    padding: 15px;
    border-radius: 12px;
    display: flex;
    justify-content: flex-start;
    align-items: center;
    margin-bottom: 20px;
    gap: 30px;
}
.scada-button {
    width: 60px;
    height: 30px;
    background: linear-gradient(to bottom, #6b6b6b, #2e2e2e);
    border-radius: 3px;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: inset -1px -1px 2px rgba(0,0,0,0.6),
                inset 1px 1px 2px rgba(255,255,255,0.2),
                1px 1px 2px rgba(0,0,0,0.8);
}
.led {
    width: 20px;
    height: 6px;
    border-radius: 0px;
}
.led.green {
    background: #00ff00;
    box-shadow: 0 0 5px #00ff00, 0 0 10px #00ff00;
    animation: blink 2s infinite;
}
.led.red {
    background: #ff0000;
    box-shadow: 0 0 5px #ff0000, 0 0 12px #ff0000;
}
.led.solid {
    animation: none;
}
@keyframes blink {
    0% { opacity: 1; }
    50% { opacity: 1; }
    50.01% { opacity: 0; }
    100% { opacity: 0; }
}
.scada-block {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
}
.scada-label {
    font-size: 14px;
    color: white;
}
.scada-title {
    font-size: 16px;
    font-weight: bold;
    color: #60EFFF;
    margin-right: 20px;
    white-space: nowrap;
}
.separator {
    width: 2px;
    height: 60px;
    background: rgba(255,255,255,0.2);
    margin: 0 10px;
}
.scada-info {

    font-size: 16px;
    color: #FFDD7F;
    font-weight: bold;

    margin-left: auto;

    white-space: normal;

    max-width: 200px;

    padding-left: 15px;

    border-left: 2px solid rgba(255,255,255,0.2);

}
</style>
</head>
<body>

<div class="container">
    <div class="header">Energy Consumption Dashboard</div>

    <div class="filters">
        <select id="location">
            <option value="">Select Location</option>
            <option>KGOC</option>
            <option>KGOC LT PANEL 1</option>
            <option>KGOC LT PANEL 2</option>
            <option>COMPLEX S/S1</option>
            <option>COMPLEX S/S1 MLTB-SS1.1</option>
            <option>COMPLEX S/S1 MLTB-SS1.2</option>
			<option>COMPLEX S/S1 MLTB-SS1.1</option>
            <option>COMPLEX S/S1 MLTB-SS1.2</option>
			<option>COMPLEX S/S 2</option>
			<option>COMPLEX S/S 2_MLTB-SS.2.1</option>
			<option>COMPLEX S/S 2_MLTB-SS.2.2</option>
			<option>COMPLEX S/S 2_MLTB-SS.2.3</option>
			<option>COMPLEX S/S 2_MLTB-SS.2.4</option>
			<option>COMPLEX S/S 3</option>
			<option>COMPLEX S/S 3_MLTB-SS.3.1</option>
			<option>COMPLEX S/S 3_MLTB-SS.3.2</option>
			<option>CSG</option>
			<option>CSG_MLTP S/S_INC1</option>
			<option>CSG_MLTP S/S_INC2</option>
			
		    
        </select>
        <input type="number" id="year" placeholder="Enter Year">
        <button onclick="generateData()">Load Data</button>

        <div id="progressContainer">
            <div id="progressShimmer"></div>
            <div id="progressFill"></div>
        </div>
    </div>

    <div class="scada-container" id="scadaContainer" style="display:none;"></div>

    <div class="dashboard" id="dashboard1">
        <div class="chart-container">
            <canvas id="chart1"></canvas>
        </div>
        <div class="side-panel">
            <div class="card">
                <div class="card-text">
                    <div class="card-title">Inc 1 Highest Amps</div>
                    <div class="card-value" id="d1c1">0 A</div>
                </div>
                <canvas id="g1"></canvas>
            </div>
            <div class="card">
                <div class="card-text">
                    <div class="card-title">Inc 1 Avg Volt</div>
                    <div class="card-value" id="d1v1">0 V</div>
                </div>
                <canvas id="g2"></canvas>
            </div>
            <div class="card">
                <div class="card-text">
                    <div class="card-title">Inc 2 Highest Amps</div>
                    <div class="card-value" id="d1c2">0 A</div>
                </div>
                <canvas id="g3"></canvas>
            </div>
            <div class="card">
                <div class="card-text">
                    <div class="card-title">Inc 2 Avg Volt</div>
                    <div class="card-value" id="d1v2">0 V</div>
                </div>
                <canvas id="g4"></canvas>
            </div>
        </div>
    </div>

    <div class="dashboard" id="dashboard2" style="display:none">
        <div class="chart-container">
            <canvas id="chart2"></canvas>
        </div>
        <div class="side-panel">
            <div class="card">
                <div class="card-text">
                    <div class="card-title">Inc 1 Highest Amps</div>
                    <div class="card-value" id="d2c1">0 A</div>
                </div>
                <canvas id="g5"></canvas>
            </div>
            <div class="card">
                <div class="card-text">
                    <div class="card-title">Inc 1 Avg Volt</div>
                    <div class="card-value" id="d2v1">0 V</div>
                </div>
                <canvas id="g6"></canvas>
            </div>
            <div class="card">
                <div class="card-text">
                    <div class="card-title">Inc 2 Highest Amps</div>
                    <div class="card-value" id="d2c2">0 A</div>
                </div>
                <canvas id="g7"></canvas>
            </div>
            <div class="card">
                <div class="card-text">
                    <div class="card-title">Inc 2 Avg Volt</div>
                    <div class="card-value" id="d2v2">0 V</div>
                </div>
                <canvas id="g8"></canvas>
            </div>
        </div>
    </div>
	<div class="dashboard" id="dashboard3" style="display:none">
    <div class="chart-container">
        <canvas id="chart3"></canvas>
    </div>
    <div class="side-panel">
        <div class="card">
            <div class="card-text">
                <div class="card-title">Inc 1 Highest Amps</div>
                <div class="card-value" id="d3c1">0 A</div>
            </div>
            <canvas id="g9"></canvas>
        </div>
        <div class="card">
            <div class="card-text">
                <div class="card-title">Inc 1 Avg Volt</div>
                <div class="card-value" id="d3v1">0 V</div>
            </div>
            <canvas id="g10"></canvas>
        </div>
        <div class="card">
            <div class="card-text">
                <div class="card-title">Inc 2 Highest Amps</div>
                <div class="card-value" id="d3c2">0 A</div>
            </div>
            <canvas id="g11"></canvas>
        </div>
        <div class="card">
            <div class="card-text">
                <div class="card-title">Inc 2 Avg Volt</div>
                <div class="card-value" id="d3v2">0 V</div>
            </div>
            <canvas id="g12"></canvas>
        </div>
    </div>
</div>


<div class="dashboard" id="dashboard4" style="display:none">
    <div class="chart-container">
        <canvas id="chart4"></canvas>
    </div>
    <div class="side-panel">
        <div class="card">
            <div class="card-text">
                <div class="card-title">Inc 1 Highest Amps</div>
                <div class="card-value" id="d4c1">0 A</div>
            </div>
            <canvas id="g13"></canvas>
        </div>
        <div class="card">
            <div class="card-text">
                <div class="card-title">Inc 1 Avg Volt</div>
                <div class="card-value" id="d4v1">0 V</div>
            </div>
            <canvas id="g14"></canvas>
        </div>
        <div class="card">
            <div class="card-text">
                <div class="card-title">Inc 2 Highest Amps</div>
                <div class="card-value" id="d4c2">0 A</div>
            </div>
            <canvas id="g15"></canvas>
        </div>
        <div class="card">
            <div class="card-text">
                <div class="card-title">Inc 2 Avg Volt</div>
                <div class="card-value" id="d4v2">0 V</div>
            </div>
            <canvas id="g16"></canvas>
        </div>
    </div>
</div>
</div>

<script>
// ─── Globals ───
panel1Total = 0;
panel2Total = 0;

/* ✅ RESET ALL DASHBOARDS */

document.getElementById("dashboard1").style.display = "flex";
document.getElementById("dashboard2").style.display = "none";
document.getElementById("dashboard3").style.display = "none";
document.getElementById("dashboard4").style.display = "none";


/* ✅ CLEAR SCADA */

const scada = document.getElementById("scadaContainer");

scada.style.display = "none";
scada.innerHTML = "";

async function generateData() {
    const loc = document.getElementById("location").value;
    const yearVal = document.getElementById("year").value;
    
    if (!loc || !yearVal) {
        alert("Select location & year");
        return;
    }

    const container = document.getElementById("progressContainer");
    const shimmer   = document.getElementById("progressShimmer");
    const fill      = document.getElementById("progressFill");

    container.style.display = "block";
    fill.style.width = "0%";
    shimmer.style.opacity = "1";

    panel1Total = 0;
    panel2Total = 0;
    document.getElementById("dashboard2").style.display = "none";
    const scada = document.getElementById("scadaContainer");
    scada.style.display = "none";
    scada.innerHTML = "";

    try {

    // ───────── KGOC MAIN ─────────
    if (loc === "KGOC") {

        await loadDashboard("KGOC LT PANEL 1", "chart1", "d1c1","d1v1","d1c2","d1v2","g1","g2","g3","g4");

        document.getElementById("dashboard2").style.display = "flex";

        await loadDashboard("KGOC LT PANEL 2", "chart2", "d2c1","d2v1","d2c2","d2v2","g5","g6","g7","g8");

        renderScadaForKGOC();
    }


    // ───────── COMPLEX S/S1 MAIN ─────────
    else if (loc === "COMPLEX S/S1") {

        const total1 =
        await loadDashboard("COMPLEX S/S 1_MLTB-SS1.1", "chart1",
        "d1c1","d1v1","d1c2","d1v2","g1","g2","g3","g4");

        document.getElementById("dashboard2").style.display = "flex";

        const total2 =
        await loadDashboard("COMPLEX S/S 1_MLTB-SS1.2", "chart2",
        "d2c1","d2v1","d2c2","d2v2","g5","g6","g7","g8");

        renderScadaForComplexSS1(total1 + total2);
    }


    // ───────── MLTB SS1.1 ─────────
    else if (loc === "COMPLEX S/S1 MLTB-SS1.1") {

        await loadDashboard("COMPLEX S/S 1_MLTB-SS1.1",
        "chart1","d1c1","d1v1","d1c2","d1v2","g1","g2","g3","g4");

        renderScadaMLTB("MLTB-SS1.1");
    }


    // ───────── MLTB SS1.2 ─────────
    else if (loc === "COMPLEX S/S1 MLTB-SS1.2") {

        await loadDashboard("COMPLEX S/S 1_MLTB-SS1.2",
        "chart1","d1c1","d1v1","d1c2","d1v2","g1","g2","g3","g4");

        renderScadaMLTB("MLTB-SS1.2");
    }


    // ───────── EXISTING PANELS ─────────
    else if (loc === "KGOC LT PANEL 1") {

        await loadDashboard(loc, "chart1",
        "d1c1","d1v1","d1c2","d1v2","g1","g2","g3","g4");

        renderScadaForPanel1();
    }


    else if (loc === "KGOC LT PANEL 2") {

        await loadDashboard(loc, "chart1",
        "d1c1","d1v1","d1c2","d1v2","g1","g2","g3","g4");

        renderScadaForPanel2();
		
    }
	
	else if (loc === "COMPLEX S/S 2")
{

document.getElementById("dashboard2").style.display="flex";
document.getElementById("dashboard3").style.display="flex";
document.getElementById("dashboard4").style.display="flex";


const t1 =
await loadDashboard("COMPLEX S/S 2_MLTB-SS.2.1",
"chart1","d1c1","d1v1","d1c2","d1v2",
"g1","g2","g3","g4");

const t2 =
await loadDashboard("COMPLEX S/S 2_MLTB-SS.2.2",
"chart2","d2c1","d2v1","d2c2","d2v2",
"g5","g6","g7","g8");

const t3 =
await loadDashboard("COMPLEX S/S 2_MLTB-SS.2.3",
"chart3","d3c1","d3v1","d3c2","d3v2",
"g9","g10","g11","g12");

const t4 =
await loadDashboard("COMPLEX S/S 2_MLTB-SS.2.4",
"chart4","d4c1","d4v1","d4c2","d4v2",
"g13","g14","g15","g16");

renderScadaForComplexSS2(t1+t2+t3+t4);

}


    else {

        await loadDashboard(loc, "chart1",
        "d1c1","d1v1","d1c2","d1v2","g1","g2","g3","g4");

    }



        fill.style.width = "100%";
        await new Promise(r => setTimeout(r, 700));
        shimmer.style.opacity = "0";
        setTimeout(() => {
            container.style.display = "none";
            fill.style.width = "0%";
        }, 600);

    } catch (err) {
        console.error("Data loading error:", err);
        fill.style.background = "linear-gradient(90deg, #ff5555, #cc0000)";
        fill.style.width = "100%";
        setTimeout(() => {
            container.style.display = "none";
            fill.style.background = "linear-gradient(90deg, #00d4ff, #7c00ff)";
            fill.style.width = "0%";
        }, 2000);
    }
}

function renderScadaForKGOC() {
    const scada = document.getElementById("scadaContainer");
    const total = panel1Total + panel2Total;
    scada.innerHTML = `
        <div class="scada-title">LT PANEL 1</div>
        <div class="scada-block">
            <div class="scada-button"><div class="led green"></div></div>
            <div class="scada-label">Inc.1</div>
        </div>
        <div class="scada-block">
            <div class="scada-button"><div class="led red solid"></div></div>
            <div class="scada-label">Bus Coupler</div>
        </div>
        <div class="scada-block">
            <div class="scada-button"><div class="led green"></div></div>
            <div class="scada-label">Inc.2</div>
        </div>
        <div class="separator"></div>
        <div class="scada-block">
            <div class="scada-button"><div class="led green"></div></div>
            <div class="scada-label">Inc.1</div>
        </div>
        <div class="scada-title">LT PANEL 2</div>
        <div class="scada-info">Total Consumption: ${total.toLocaleString()} kWh</div>
    `;
    scada.style.display = "flex";
}

function renderScadaForPanel1() {
    const scada = document.getElementById("scadaContainer");
    scada.innerHTML = `
        <div class="scada-title">LT PANEL 1</div>
        <div class="scada-block">
            <div class="scada-button"><div class="led green"></div></div>
            <div class="scada-label">Inc.1</div>
        </div>
        <div class="scada-block">
            <div class="scada-button"><div class="led red solid"></div></div>
            <div class="scada-label">Bus Coupler</div>
        </div>
        <div class="scada-block">
            <div class="scada-button"><div class="led green"></div></div>
            <div class="scada-label">Inc.2</div>
        </div>
        <div class="scada-info">FEEDING FROM KOC-10 MEW SUBSTATION</div>
    `;
    scada.style.display = "flex";
}

function renderScadaForPanel2() {
    const scada = document.getElementById("scadaContainer");
    scada.innerHTML = `
        <div class="scada-block">
            <div class="scada-button"><div class="led green"></div></div>
            <div class="scada-label">Inc.1</div>
        </div>
        <div class="scada-title" style="margin-left:20px;">LT PANEL 2</div>
        <div class="scada-info">FEEDING FROM KOC-10 MEW SUBSTATION</div>
    `;
    scada.style.display = "flex";
}

function renderScadaForComplexSS2(total)
{

const scada=document.getElementById("scadaContainer");

scada.innerHTML=`

<div style="display:flex;flex-direction:column;align-items:center">

<div class="scada-title">MLTB-SS2.1</div>

<div style="display:flex;gap:20px">

<div class="scada-block">
<div class="scada-button"><div class="led green"></div></div>
<div class="scada-label">Inc.1</div>
</div>

<div class="scada-block">
<div class="scada-button"><div class="led red solid"></div></div>
<div class="scada-label">Bus Coupler</div>
</div>

<div class="scada-block">
<div class="scada-button"><div class="led green"></div></div>
<div class="scada-label">Inc.2</div>
</div>

</div>

</div>


<div class="separator"></div>


<div style="display:flex;flex-direction:column;align-items:center">

<div class="scada-title">MLTB-SS2.2</div>

<div style="display:flex;gap:20px">

<div class="scada-block">
<div class="scada-button"><div class="led green"></div></div>
<div class="scada-label">Inc.1</div>
</div>

<div class="scada-block">
<div class="scada-button"><div class="led red solid"></div></div>
<div class="scada-label">Bus Coupler</div>
</div>

<div class="scada-block">
<div class="scada-button"><div class="led green"></div></div>
<div class="scada-label">Inc.2</div>
</div>

</div>

</div>


<div class="separator"></div>


<div style="display:flex;flex-direction:column;align-items:center">

<div class="scada-title">MLTB-SS2.3</div>

<div style="display:flex;gap:20px">

<div class="scada-block">
<div class="scada-button"><div class="led green"></div></div>
<div class="scada-label">Inc.1</div>
</div>

<div class="scada-block">
<div class="scada-button"><div class="led red solid"></div></div>
<div class="scada-label">Gen Incomer</div>
</div>

</div>

</div>



<div class="separator"></div>


<div style="display:flex;flex-direction:column;align-items:center">

<div class="scada-title">MLTB-SS2.4</div>

<div style="display:flex;gap:20px">

<div class="scada-block">
<div class="scada-button"><div class="led green"></div></div>
<div class="scada-label">Inc.1</div>
</div>

<div class="scada-block">
<div class="scada-button"><div class="led red solid"></div></div>
<div class="scada-label">Gen Incomer</div>
</div>

</div>

</div>



<div class="scada-info">

COMPLEX S/S2 TOTAL :

${total.toLocaleString()} kWh

</div>


`;

scada.style.display="flex";

}

async function loadDashboard(panel, chartId, c1, v1, c2, v2, g1, g2, g3, g4) {
    const yearVal = document.getElementById("year").value;
    let inc1Name;
let inc2Name;


// SPECIAL HANDLING FOR COMPLEX S/S
if(panel.includes("COMPLEX S/S"))
{

inc1Name = panel + "_INC1";
inc2Name = panel + "_INC2";

}

else
{

inc1Name = panel + " INC 1";
inc2Name = panel + " INC 2";

}


const inc1 = await fetchData(inc1Name, yearVal);
const inc2 = await fetchData(inc2Name, yearVal);

    
    const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
    const data1 = months.map(m => inc1.monthlyData?.[m] || 0);
    const data2 = months.map(m => inc2.monthlyData?.[m] || 0);
    
    const total1 = data1.reduce((a,b)=>a+b,0);
    const total2 = data2.reduce((a,b)=>a+b,0);
    const grandTotal = total1 + total2;

    createChart(chartId, months, data1, data2, panel);
    setValue(c1, inc1.highestCurrent, "A");
    setValue(v1, inc1.avgVoltage, "V", true);
    setValue(c2, inc2.highestCurrent, "A");
    setValue(v2, inc2.avgVoltage, "V", true);
    
    createGauge(g1, inc1.highestCurrent, 1000);
    createGauge(g2, inc1.avgVoltage, 500);
    createGauge(g3, inc2.highestCurrent, 1000);
    createGauge(g4, inc2.avgVoltage, 500);

    if (panel.includes("KGOC LT PANEL 1")) panel1Total = grandTotal;
    if (panel.includes("KGOC LT PANEL 2")) panel2Total = grandTotal;

    return grandTotal;
}

function setValue(id, val, unit, isInteger = false) {
    if (isInteger) val = Math.round(val);
    document.getElementById(id).innerText = Number(val).toLocaleString() + " " + unit;
}

async function fetchData(loc, year) {
    const url = "https://script.google.com/macros/s/AKfycbyRKYGnOfbVovVWY9-T197y_Kb8PWFP-TwVhL7TUrfE85gCnhjpBscnBwvh6AEqFxs1/exec?location=" + encodeURIComponent(loc) + "&year=" + year;
    return await (await fetch(url)).json();
}

function createChart(id, labels, d1, d2, title) {
    const canvas = document.getElementById(id);
    Chart.getChart(canvas)?.destroy();
    const ctx = canvas.getContext("2d");

    const g1 = ctx.createLinearGradient(0,0,0,400);
    g1.addColorStop(0,"#60EFFF");
    g1.addColorStop(1,"#0061FF");

    const g2 = ctx.createLinearGradient(0,0,0,400);
    g2.addColorStop(0,"#FFDD7F");
    g2.addColorStop(1,"#FF9C00");

    const total1 = d1.reduce((a,b)=>a+b,0);
    const total2 = d2.reduce((a,b)=>a+b,0);
    const grandTotal = total1 + total2;

    new Chart(canvas, {
        type: "bar",
        data: {
            labels,
            datasets: [
                {
                    label: `Inc1 (${total1.toLocaleString()} kWh)`,
                    data: d1,
                    backgroundColor: g1,
                    borderRadius: 5
                },
                {
                    label: `Inc2 (${total2.toLocaleString()} kWh)`,
                    data: d2,
                    backgroundColor: g2,
                    borderRadius: 5
                },
                // ✅ Dummy dataset only for legend Total
                {
                    label: `TOTAL: ${grandTotal.toLocaleString()} kWh`,
                    data: [],
                    backgroundColor: "transparent",
                    borderColor: "transparent"
                }
            ]
        },
        plugins: [ChartDataLabels],
        options: {
            responsive: true,
            maintainAspectRatio: false,

            plugins: {

                title: {
                    display: true,
                    text: title,
                    color: "white",
                    font: { size: 18, weight: "bold" }
                },

                legend: {
                    labels: {
                        color: "white",
                        font: { size: 14, weight: "bold" },

                        // ✅ Hide box for TOTAL
                        generateLabels(chart) {

                            const labels =
                                Chart.defaults.plugins.legend.labels.generateLabels(chart);

                            labels.forEach(label => {

                                if (label.text.includes("TOTAL")) {

                                    label.fillStyle = "transparent";
                                    label.strokeStyle = "transparent";
                                }
                            });

                            return labels;
                        }
                    }
                },

                datalabels: {
                    color: "#fff",
                    rotation: 90,
                    anchor: "center",
                    align: "center",
                    font: { weight: "bold" }
                }
            },

            scales: {
                x: {
                    ticks: { color: "white" },
                    grid: { display: false }
                },
                y: {
                    ticks: { color: "white" },
                    grid: { color: "rgba(255,255,255,0.1)" }
                }
            }
        }
    });
}

function createGauge(id, val, max) {
    const canvas = document.getElementById(id);
    Chart.getChart(canvas)?.destroy();
    new Chart(canvas, {
        type: "doughnut",
        data: { datasets: [{ data: [val, max - val], backgroundColor: ["#60EFFF", "#ffffff22"], borderWidth: 0 }] },
        options: { cutout: "75%", plugins: { legend: { display: false } } }
    });
}
function renderScadaMLTB(name)
{

const scada = document.getElementById("scadaContainer");

scada.innerHTML = `

<div style="display:flex;flex-direction:column;align-items:center;margin-right:20px">

<div class="scada-title">${name}</div>

<div style="display:flex;gap:20px">

<div class="scada-block">
<div class="scada-button"><div class="led green"></div></div>
<div class="scada-label">Inc.1</div>
</div>

<div class="scada-block">
<div class="scada-button"><div class="led red solid"></div></div>
<div class="scada-label">Bus Coupler</div>
</div>

<div class="scada-block">
<div class="scada-button"><div class="led green"></div></div>
<div class="scada-label">Inc.2</div>
</div>

</div>

</div>


<div class="scada-info">
11KV POWER SUPPLY FED FROM COMPLEX S/S1 HT SECTION
</div>

`;

scada.style.display="flex";

}
function renderScadaForComplexSS1(total)
{

const scada = document.getElementById("scadaContainer");

scada.innerHTML = `

<div style="display:flex;flex-direction:column;align-items:center">

<div class="scada-title">MLTB-SS1.1</div>

<div style="display:flex;gap:20px">

<div class="scada-block">
<div class="scada-button"><div class="led green"></div></div>
<div class="scada-label">Inc.1</div>
</div>

<div class="scada-block">
<div class="scada-button"><div class="led red solid"></div></div>
<div class="scada-label">Bus Coupler</div>
</div>

<div class="scada-block">
<div class="scada-button"><div class="led green"></div></div>
<div class="scada-label">Inc.2</div>
</div>

</div>

</div>


<div class="separator"></div>



<div style="display:flex;flex-direction:column;align-items:center">

<div class="scada-title">MLTB-SS1.2</div>

<div style="display:flex;gap:20px">

<div class="scada-block">
<div class="scada-button"><div class="led green"></div></div>
<div class="scada-label">Inc.1</div>
</div>

<div class="scada-block">
<div class="scada-button"><div class="led red solid"></div></div>
<div class="scada-label">Bus Coupler</div>
</div>

<div class="scada-block">
<div class="scada-button"><div class="led green"></div></div>
<div class="scada-label">Inc.2</div>
</div>

</div>

</div>



<div class="scada-info">

COMPLEX S/S1 TOTAL :

${total.toLocaleString()} kWh

</div>


`;

scada.style.display="flex";

}

</script>
</body>
</html>